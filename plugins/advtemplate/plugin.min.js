/*!
 * Tiny Advanced Template plugin
 *
 * Copyright (c) 2023 Ephox Corporation DBA Tiny Technologies, Inc.
 * Licensed under the Tiny commercial license. See https://www.tiny.cloud/legal/
 *
 * Version: 1.3.0-38
 */

!function(){"use strict";const e=e=>parseInt(e,10),t=(e,t)=>{const n=e-t;return 0===n?0:n>0?1:-1},n=(e,t,n)=>({major:e,minor:t,patch:n}),a=t=>{const a=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(t);return a?n(e(a[1]),e(a[2]),e(a[3])):n(0,0,0)},r=e=>t=>(e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&(n=a=e,(r=String).prototype.isPrototypeOf(n)||(null===(o=a.constructor)||void 0===o?void 0:o.name)===r.name)?"string":t;var n,a,r,o})(t)===e,o=e=>t=>typeof t===e,i=r("string"),l=r("object"),s=r("array"),c=o("boolean"),m=(void 0,e=>undefined===e);const d=e=>null==e,p=e=>!d(e),u=o("function"),g=o("number"),y=()=>{},v=e=>()=>e,h=e=>e,f=e=>e(),_=v(!1),b=v(!0);class w{constructor(e,t){this.tag=e,this.value=t}static some(e){return new w(!0,e)}static none(){return w.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?w.some(e(this.value)):w.none()}bind(e){return this.tag?e(this.value):w.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:w.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return p(e)?w.some(e):w.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}w.singletonNone=new w(!1);const x=Array.prototype.slice,C=Array.prototype.indexOf,S=Array.prototype.push,A=(e,t)=>((e,t)=>C.call(e,t))(e,t)>-1,T=(e,t)=>{const n=e.length,a=new Array(n);for(let r=0;r<n;r++){const n=e[r];a[r]=t(n,r)}return a},E=(e,t)=>{for(let n=0,a=e.length;n<a;n++)if(t(e[n],n))return w.some(n);return w.none()},D=(e,t)=>(e=>{const t=[];for(let n=0,a=e.length;n<a;++n){if(!s(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);S.apply(t,e[n])}return t})(T(e,t)),O=(e,t)=>{for(let n=0,a=e.length;n<a;++n)if(!0!==t(e[n],n))return!1;return!0},M=e=>((e,t)=>0<e.length?w.some(e[0]):w.none())(e);class P extends Error{constructor(e){super(e),this.name="AdvTemplateError"}}const I=e=>{const t=t=>t(e),n=v(e),a=()=>r,r={tag:!0,inner:e,fold:(t,n)=>n(e),isValue:b,isError:_,map:t=>j.value(t(e)),mapError:a,bind:t,exists:t,forall:t,getOr:n,or:a,getOrThunk:n,orThunk:a,getOrDie:n,each:t=>{t(e)},toOptional:()=>w.some(e)};return r},N=e=>{const t=()=>n,n={tag:!1,inner:e,fold:(t,n)=>t(e),isValue:_,isError:b,map:t,mapError:t=>j.error(t(e)),bind:t,exists:_,forall:b,getOr:h,or:h,getOrThunk:f,orThunk:f,getOrDie:(a=String(e),()=>{throw new Error(a)}),each:y,toOptional:w.none};var a;return n},j={value:I,error:N,fromOption:(e,t)=>e.fold((()=>N(t)),I)},k=Object.keys,$=Object.hasOwnProperty,R=(e,t)=>$.call(e,t),B=e=>i(e)&&e.length>0,L=e=>B(e),z=e=>R(e,"id")&&L(e.id),U=e=>R(e,"title")&&B(e.title),V=e=>R(e,"content")&&B(e.content),K=e=>l(e)&&z(e)&&U(e)&&R(e,"items")&&F(e.items),q=e=>l(e)&&z(e)&&U(e)&&(e=>!R(e,"items")||F(e.items))(e),F=e=>s(e)&&O(e,q),H=e=>R(e,"items")&&W(e.items),G=e=>l(e)&&U(e)&&((e=>V(e))(e)||H(e)),W=e=>s(e)&&O(e,G),Y=(e,t)=>n=>e(n)?j.value(n):j.error(t),J=Y((e=>l(e)&&(e=>{for(const t in e)if($.call(e,t))return!1;return!0})(e)),"response should contain empty object"),Q=Y((e=>l(e)&&z(e)),"response should contain id"),X=Y((e=>l(e)&&z(e)&&U(e)&&V(e)),"response contains invalid template data"),Z=e=>F(e)?(e=>{const t=e=>D(e,(e=>K(e)?[e.id,...t(e.items)]:[e.id])),n=t(e);return n.length===[...new Set(n)].length})(e)?j.value(e):j.error("response contains duplicated ids"):j.error("response contains invalid data"),ee=e=>t=>t.options.get(e),te=e=>{const t=(t,n)=>{var a,r;a=t,r=(e,t)=>(...a)=>((e,t,n)=>{return l(a=n)&&u(a.then)&&u(a.catch)?n.then((n=>t(n).fold((t=>Promise.reject(new P(`${e} ${t}`))),(e=>Promise.resolve(e))))):Promise.reject(new P(`${e} should return a Promise`));var a})(e,n,t(...a)),e.options.register(a,{processor:e=>u(e)?{valid:!0,value:r(a,e)}:{valid:!1,message:"Must be a function returning promise"},default:()=>Promise.reject(new P(`${a} option is not configured`))})};t("advtemplate_create_category",Q),t("advtemplate_rename_category",J),t("advtemplate_move_category_items",J),t("advtemplate_delete_category",J),t("advtemplate_create_template",Q),t("advtemplate_rename_template",J),t("advtemplate_update_template",J),t("advtemplate_move_template",J),t("advtemplate_get_template",X),t("advtemplate_delete_template",J),t("advtemplate_delete_all",J),t("advtemplate_list",Z),e.options.register("advtemplate_templates",{processor:W})},ne=ee("advtemplate_create_category"),ae=ee("advtemplate_rename_category"),re=ee("advtemplate_move_category_items"),oe=ee("advtemplate_delete_category"),ie=ee("advtemplate_create_template"),le=ee("advtemplate_rename_template"),se=ee("advtemplate_move_template"),ce=ee("advtemplate_get_template"),me=ee("advtemplate_delete_template"),de=ee("advtemplate_list"),pe=ee("advtemplate_templates"),ue=ee("content_style"),ge=ee("body_class"),ye=ee("content_css_cors"),ve=(e,t)=>e?w.some(t):w.none();let he=0;const fe=()=>{const e=(e=>{const t=(e=>{let t=e;return{get:()=>t,set:e=>{t=e}}})(w.none()),n=()=>t.get().each(e);return{clear:()=>{n(),t.set(w.none())},isSet:()=>t.get().isSome(),get:()=>t.get(),set:e=>{n(),t.set(w.some(e))}}})(y);return{...e,on:t=>e.get().each(t)}},_e=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},be=(e,t)=>{const n=(t||document).createElement(e);return _e(n)},we=_e;"undefined"!=typeof window?window:Function("return this;")();const xe="{{mce-cursor}}",Ce=(e,t)=>{((e,t)=>ve(-1!==t.indexOf(xe),t).bind((t=>{const n=tinymce.html.DomParser(void 0,e.schema),a=fe();var r;n.addNodeFilter("#text",(r=a,e=>{((e,t)=>{for(let n=0;n<e.length;n++){const a=t(e[n]);if(a.isSome())return a}return w.none()})(e,(e=>w.from(e.value).map((t=>({node:e,textContent:t,index:t.indexOf(xe)}))).filter((({index:e})=>-1!==e)))).each((({node:e,textContent:t,index:n})=>{const a=tinymce.html.Node.create("span");if(n>0){const e=tinymce.html.Node.create("#text");e.value=t.substring(0,n),a.append(e)}const o=(e=>{const t=(new Date).getTime(),n=Math.floor(1e9*Math.random());return he++,"advtemplate-cursor-marker_"+n+he+String(t)})();r.set(o);const i=tinymce.html.Node.create("span",{"data-mce-id":o,"data-mce-cursor-marker":"true"}),l=tinymce.html.Node.create("#text");if(l.value="\ufeff",i.append(l),a.append(i),t.length>n+14){const e=tinymce.html.Node.create("#text");e.value=t.substring(n+14,t.length),a.append(e)}e.replace(a),a.unwrap()}))}));const o=n.parse(t,{insert:!0});return ve(a.isSet(),{content:tinymce.html.Serializer({validate:!0},e.schema).serialize(o),cursorMarkerId:a.get().getOrDie()})})))(e,t).fold((()=>e.insertContent(t)),(({cursorMarkerId:t,content:n})=>{e.undoManager.transact((()=>{e.insertContent(n),((e,t)=>{const n=we(e.getBody());var a,r;(a=n,r=`span[data-mce-id="${t}"]`,((e,t)=>{const n=void 0===t?document:t.dom;return 1!==(a=n).nodeType&&9!==a.nodeType&&11!==a.nodeType||0===a.childElementCount?w.none():w.from(n.querySelector(e)).map(we);var a})(r,a)).each((t=>{const n=e.dom.createRng();n.setStartAfter(t.dom),n.setEndAfter(t.dom),e.selection.setRng(n),e.selection.scrollIntoView(),(e=>{const t=e.dom;null!==t.parentNode&&t.parentNode.removeChild(t)})(t)}))})(e,t)}))}))},Se=(e,t)=>ce(e)(t).then((t=>{Ce(e,t.content)})),Ae={text:"Uncategorized",value:""},Te=(e,t)=>{const n=((e,n)=>{const a=[];for(let n=0,o=e.length;n<o;n++){const o=e[n];K(r=o)&&(!p(t)||r.id!==t)&&a.push(o)}var r;return a})(e);return[...t===Ae.value?[]:[Ae],...T(n,(({id:e,title:t})=>({text:t,value:e})))]},Ee=(e,t)=>{return(n=t,a=t=>K(t)&&A(T(t.items,(({id:e})=>e)),e),((e,t,n)=>{for(let a=0,r=e.length;a<r;a++){const r=e[a];if(t(r,a))return w.some(r);if(n(r,a))break}return w.none()})(n,a,_)).map((e=>e.id)).getOr(Ae.value);var n,a},De=e=>ve(e!==Ae.value,e).getOrUndefined(),Oe=(e,t,n)=>e.options.isSet(t)?[n]:[],Me=(e,t,n)=>{const a=e=>{const a=[...Oe(n,"advtemplate_rename_category",{type:"menuitem",text:"Rename...",onAction:t.renameCategory(e)}),...Oe(n,"advtemplate_move_category_items",{type:"menuitem",text:"Move all items...",enabled:e.items.length>0,onAction:t.moveCategoryItems(e.id)}),...Oe(n,"advtemplate_delete_category",{type:"separator"}),...Oe(n,"advtemplate_delete_category",{type:"menuitem",icon:"remove",text:"Delete all",onAction:t.deleteCategory(e.id)})];return a.length>0?{menu:{type:"menubutton",icon:"image-options",fetch:e=>e(a)}}:{}},r=e=>{const a=[...Oe(n,"advtemplate_rename_template",{type:"menuitem",text:"Rename...",onAction:t.renameTemplate(e)}),...Oe(n,"advtemplate_move_template",{type:"menuitem",text:"Move to...",onAction:t.moveTemplate(e.id)}),...Oe(n,"advtemplate_delete_template",{type:"separator"}),...Oe(n,"advtemplate_delete_template",{type:"menuitem",icon:"remove",text:"Delete",onAction:t.deleteTemplate(e.id)})];return a.length>0?{menu:{type:"menubutton",icon:"image-options",fetch:e=>e(a)}}:{}};return T(e,(e=>K(e)?(e=>({type:"directory",id:e.id,title:e.title,children:Me(e.items,t,n),...a(e)}))(e):(e=>({type:"leaf",id:e.id,title:e.title,...r(e)}))(e)))},Pe=e=>t=>{w.from(t.message).bind((e=>(console.error(e),ve(!(e=>e instanceof P)(t),e)))).or(w.some("Operation failed")).each(e.windowManager.alert)},Ie=(e,t)=>((e,t,n)=>{const a=((e,t)=>{const n=((e,t)=>{const n=e.dom.getAttribute(t);return null===n?void 0:n})(e,t);return void 0===n||""===n?[]:n.split(" ")})(e,t);return((e,t,n)=>{((e,t,n)=>{if(!(i(n)||c(n)||g(n)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")})(e.dom,t,n)})(e,t,a.concat([n]).join(" ")),!0})(e,"class",t),Ne=(e=>{let t,n=!1;return(...a)=>(n||(n=!0,t=e.apply(null,a)),t)})((()=>{const e=tinymce.Env.os.isMacOS()||tinymce.Env.os.isiOS()?e=>e.metaKey:e=>e.ctrlKey&&!e.altKey;return`<script>(${(e=>{document.addEventListener("click",(t=>{for(let n=t.target;n;n=n.parentNode)"A"!==n.nodeName||e(t)||t.preventDefault()}),!1)}).toString()})(${e.toString()})<\/script>`})),je=(e,t)=>tinymce.html.Serializer({validate:!0},e.schema).serialize(e.parser.parse(t,{insert:!0})),ke=e=>`<style type="text/css">${e}</style>`,$e=(e,t)=>w.from(e).filter((e=>e.length>0)).map(t).getOr(""),Re=ke(".mce-advtemplate-preview-placeholder { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; color: #b1aeae; font-family: sans-serif; }"),Be=(e,t)=>{if(-1===t.indexOf("<html>")){const n=$e(ue(e),ke),a=ye(e)?' crossorigin="anonymous"':"",r=T(e.contentCSS,(t=>`<link type="text/css" rel="stylesheet" href="${e.documentBaseURI.toAbsolute(t)}"${a}>`)),o=e.dom.encode,i=`<base href="${o(e.documentBaseURI.getURI())}">`,l=$e(ge(e),(e=>` class="${o(e)}"`)),s=$e(e.getBody().dir,(e=>` dir="${o(e)}"`));return["<!DOCTYPE html><html><head>",i,r.join(""),Re,n,Ne(),`</head><body${l}${s}>`,je(e,t),"</body></html>"].join("")}return t},Le=e=>{const t=be("div");var n,a;return a="mce-advtemplate-preview-placeholder",(e=>void 0!==e.dom.classList)(n=t)?n.dom.classList.add(a):Ie(n,a),((e,t)=>{e.dom.textContent=t})(t,e.translate("Select template to preview")),Be(e,(e=>{const t=be("div");return((e,t)=>{e.dom.appendChild(t.dom)})(t,we(e.dom.cloneNode(!0))),(e=>e.dom.innerHTML)(t)})(t))},ze=async e=>{let t=!1;const n=fe();let a=[];const r=a=>{ce(e)(a).then((r=>{m.setData({preview:Be(e,r.content)}),n.set(a),t||(t=!0,m.setEnabled("submit",!0))}))},o=(e,t)=>{if(0===t.length)return e;{const n=t.toLowerCase(),a=((e,t)=>{const n=x.call(e,0);return n.sort(((e,t)=>e.index-t.index)),n})(D((e=>{const t=(e,n)=>((e,n,a)=>(((e,t)=>{for(let n=0,a=e.length;n<a;n++)t(e[n],n)})(e,((e,n)=>{var r,o;r=a,a="directory"===(o=e).type?[o,...t(o.children,r)]:[...r,o]})),a))(e,0,n);return t(e,[])})(e),(e=>{const t=e.title.toLowerCase().indexOf(n);return t>=0?[{item:e,index:t}]:[]})));return T(a,(({item:e})=>e))}},i=(l,c)=>({title:"Templates",size:"large",onChange:()=>{const e=m.getData();m.redial(i(l,e))},onAction:(t,n)=>{"addcategory"===n.name&&((e,t)=>{e.windowManager.open({title:"New category",body:{type:"panel",items:[{type:"input",name:"title",label:"Category name"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0,enabled:!1}],onChange:e=>{const t=e.getData();e.setEnabled("save",t.title.length>0)},onSubmit:n=>{const{title:a}=n.getData();ne(e)(a).then((async()=>{await t(),n.close()})).catch(Pe(e))}})})(e,s)},initialData:c,body:{type:"panel",classes:["tox-advtemplate"],items:[{type:"grid",columns:2,items:[{type:"panel",items:[{type:"input",name:"search",placeholder:"Search"},{type:"tree",items:o(l,c.search),onLeafAction:r,onToggleExpand:e=>{a=e},defaultExpandedIds:c.search.length>0?[]:a,...n.get().fold((()=>({})),(e=>({defaultSelectedId:e})))}]},{type:"iframe",name:"preview",sandboxed:!1,transparent:!1}]}]},buttons:[...Oe(e,"advtemplate_create_category",{type:"custom",name:"addcategory",text:"New category",align:"start"}),{type:"cancel",name:"cancel",text:"Cancel"},{enabled:t,type:"submit",name:"submit",text:"Insert",primary:!0}],onSubmit:t=>{n.get().each((n=>{Se(e,n).then(t.close).catch(Pe(e))}))}}),l=async t=>{const n=await de(e)();return Me(n,t,e)},s=async(t=!1)=>{const n=await l(c),a=m.getData();t&&(a.preview=Le(e)),m.redial(i(n,a))},c=((e,t,n)=>({renameCategory:t=>()=>((e,t,n)=>{e.windowManager.open({title:"Rename category",initialData:{title:n.title},body:{type:"panel",items:[{type:"input",name:"title",label:"Category name"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onChange:e=>{const t=e.getData();e.setEnabled("save",t.title.length>0)},onSubmit:a=>{const{title:r}=a.getData();ae(e)(n.id,r).then((async()=>{await t(),a.close()})).catch(Pe(e))}})})(e,n,t),renameTemplate:t=>()=>((e,t,n)=>{e.windowManager.open({title:"Rename template",initialData:{title:n.title},body:{type:"panel",items:[{type:"input",name:"title",label:"Template name"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onChange:e=>{const t=e.getData();e.setEnabled("save",t.title.length>0)},onSubmit:a=>{const{title:r}=a.getData();le(e)(n.id,r).then((async()=>{await t(),a.close()})).catch(Pe(e))}})})(e,n,t),moveTemplate:t=>()=>{(async(e,t,n)=>{const a=await de(e)();e.windowManager.open({title:"Move to",body:{type:"panel",items:[{type:"listbox",name:"category",label:"Category",items:Te(a,Ee(n,a))}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:a=>{const{category:r}=a.getData();se(e)(n,De(r)).then((async()=>{await t(),a.close()})).catch(Pe(e))}})})(e,n,t)},moveCategoryItems:t=>()=>{(async(e,t,n)=>{const a=await de(e)();e.windowManager.open({title:"Move all items",body:{type:"panel",items:[{type:"listbox",name:"category",label:"Category",items:Te(a,n)}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:a=>{const{category:r}=a.getData();re(e)(n,De(r)).then((async()=>{await t(),a.close()})).catch(Pe(e))}})})(e,n,t)},deleteTemplate:a=>()=>{e.windowManager.confirm("Are you sure you want to permanently delete the template?",(r=>{r&&me(e)(a).then((async()=>{t.get().exists((e=>e===a))?(t.clear(),await n(!0)):await n(!1)})).catch(Pe(e))}))},deleteCategory:t=>()=>{e.windowManager.confirm("Are you sure you want to permanently delete the category and all its content?",(a=>{a&&oe(e)(t).then((async()=>{await n()})).catch(Pe(e))}))}}))(e,n,s),m=e.windowManager.open(i(await l(c),{preview:Le(e),search:""}))},Ue=(e,t,n)=>m(n)?e.execCommand(t):e.execCommand(t,!1,n),Ve=(Ke=/^\s+|\s+$/g,e=>e.replace(Ke,""));var Ke;tinymce.PluginManager.requireLangPack("advtemplate","ar,bg_BG,ca,cs,da,de,el,es,eu,fa,fi,fr_FR,he_IL,hi,hr,hu_HU,id,it,ja,kk,ko_KR,ms,nb_NO,nl,pl,pt_BR,pt_PT,ro,ru,sk,sl_SI,sv_SE,th_TH,tr,uk,vi,zh_CN,zh_TW"),tinymce.PluginManager.add("advtemplate",(e=>{((e,n)=>!!e&&-1===((e,n)=>{const a=t(e.major,n.major);if(0!==a)return a;const r=t(e.minor,n.minor);if(0!==r)return r;const o=t(e.patch,n.patch);return 0!==o?o:0})((e=>a((e=>[e.majorVersion,e.minorVersion].join(".").split(".").slice(0,3).join("."))(e)))(e),a(n)))(tinymce,"6.5.0")?console.error("The advtemplate plugin requires at least version 6.5.0 of TinyMCE."):(te(e),(e=>{w.from(pe(e)).each((t=>{const n=((e=[])=>{let t=[],n={},a={},r=0;const o=()=>(++r).toString(),l=e=>w.from(a[e]).getOrDie("Category not found"),s=e=>d(e)?t:l(e).items,c=(e,t)=>{if(!(i(t)&&(n=Ve(t),n.length>0)))throw new Error("Invalid title");var n;if(((e,n)=>{for(let n=0,a=e.length;n<a;n++)if(e[n].title===t)return!0;return!1})(e))throw new Error("The name already exists")},m=e=>w.from(n[e]).getOrDie("Template not found"),p=e=>{c(t,e);const n=o(),r={id:n,title:e,items:[]};return t.push(r),a[n]=r,{...r}},u=(e,t,a)=>{const r=s(a);c(r,e);const i=o(),l={id:i,title:e,content:t};return r.push(l),n[i]=[l,a],{...l}},g=(e,t)=>{const n=s(t);E(n,(t=>t.id===e)).each((e=>n.splice(e,1)))},y=async(e,t)=>{const[a,r]=m(e);return s(t).push(a),g(e,r),n[e]=[a,t],Promise.resolve({})},v=(e,t)=>{for(const n of e)if(H(n)){const e=p(n.title);v(n.items,e.id)}else u(n.title,n.content,t)};return v(e),{advtemplate_create_category:async e=>{const{id:t}=p(e);return Promise.resolve({id:t})},advtemplate_rename_category:async(e,n)=>{const a=l(e);return a.title===n||(c(t,n),a.title=n),Promise.resolve({})},advtemplate_delete_category:async e=>(((t,n)=>{for(let n=t.length-1;n>=0;n--)a=t[n],g(a.id,e);var a})(l(e).items),E(t,(t=>t.id===e)).each((e=>t.splice(e,1))),delete a[e],Promise.resolve({})),advtemplate_create_template:async(e,t,n)=>{const{id:a}=u(e,t,n);return Promise.resolve({id:a})},advtemplate_rename_template:async(e,t)=>{const[n,a]=m(e);if(n.title===t)return Promise.resolve({});const r=s(a);return c(r,t),n.title=t,Promise.resolve({})},advtemplate_update_template:async(e,t)=>{const[n]=m(e);return n.content=t,Promise.resolve({})},advtemplate_move_template:y,advtemplate_get_template:async e=>{const[t]=m(e);return Promise.resolve({...t})},advtemplate_delete_template:async e=>{const[,t]=m(e);return g(e,t),delete n[e],Promise.resolve({})},advtemplate_list:async(e=!1)=>{if(e)return Promise.resolve([...t]);{const e=T(t,(e=>K(e)?{id:e.id,title:e.title,items:T(e.items,(({id:e,title:t})=>({id:e,title:t})))}:{id:e.id,title:e.title}));return Promise.resolve(e)}},advtemplate_delete_all:async()=>(t=[],n={},a={},Promise.resolve({})),advtemplate_move_category_items:async(e,t)=>{const n=s(e);for(let e=M(n);e.isSome();e=M(n))await y(e.getOrDie().id,t);return Promise.resolve({})}}})(t);((t,n)=>{const a=k(t);for(let n=0,i=a.length;n<i;n++){const i=a[n];r=t[i],A(["advtemplate_list","advtemplate_get_template"],o=i)?e.options.set(o,r):e.options.unset(o)}var r,o})(n)}))})(e),(e=>{const t=(t,n)=>{e.addCommand(t,n)};t("AdvTemplateInsertDialog",(()=>{ze(e)})),e.options.isSet("advtemplate_create_template")&&t("AdvTemplateAddDialog",(()=>{(async e=>{const t=await de(e)();e.windowManager.open({title:"New template",body:{type:"panel",items:[{type:"input",name:"title",label:"Template name"},{type:"listbox",name:"category",label:"Category",items:Te(t)}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0,enabled:!1}],onChange:e=>{const t=e.getData();e.setEnabled("save",t.title.length>0)},onSubmit:t=>{const{title:n,category:a}=t.getData();ie(e)(n,e.selection.getContent(),De(a)).then((()=>{t.close(),e.notificationManager.open({text:"Template successfully saved",type:"success",timeout:2e3})})).catch(Pe(e))}})})(e)})),t("AdvTemplateInsertTemplateById",((t,n)=>{if(!L(n))throw new Error("Id should be non-empty string");Se(e,n).catch((e=>{console.error("Insert template by id failed due to:",e)}))}))})(e),(e=>{e.options.isSet("advtemplate_create_template")&&e.ui.registry.addButton("addtemplate",{tooltip:"Save as template",icon:"template-add",onAction:()=>{Ue(e,"AdvTemplateAddDialog")},onSetup:t=>{t.setEnabled(!1);const n=()=>{t.setEnabled(!e.selection.isCollapsed())};return e.on("NodeChange SelectionChange",n),()=>{e.off("NodeChange SelectionChange",n)}}}),e.ui.registry.addButton("inserttemplate",{tooltip:"Insert template",icon:"template",onSetup:t=>{const n=()=>{t.setEnabled(e.selection.isEditable())};return e.on("NodeChange",n),n(),()=>{e.off("NodeChange",n)}},onAction:()=>{Ue(e,"AdvTemplateInsertDialog")}})})(e),(e=>{e.ui.registry.addMenuItem("inserttemplate",{text:"Template...",icon:"template",onSetup:t=>(t.setEnabled(e.selection.isEditable()),y),onAction:()=>Ue(e,"AdvTemplateInsertDialog")}),e.options.isSet("advtemplate_create_template")&&e.ui.registry.addMenuItem("addtemplate",{text:"Save as template...",icon:"template-add",onAction:()=>e.execCommand("AdvTemplateAddDialog"),onSetup:t=>(t.setEnabled(!e.selection.isCollapsed()),y)}),e.ui.registry.addContextMenu("advtemplate",{update:v("addtemplate")})})(e))}))}();